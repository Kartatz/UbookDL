name: Java Ci

on:
  push:
    branches:
        - '**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@main
      with:
        submodules: true
    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install --assume-yes gcc-arm-linux-gnueabi gcc-aarch64-linux-gnu gcc-i686-linux-gnu mingw-w64
    - name: Build with CMake
      run: |
        patch --strip=1 --input=./patches/curl.patch
        
        mkdir build && cd build
        
        declare -ra hosts=(
            aarch64-linux-gnu
            arm-linux-gnueabi
            armv7a-linux-androideabi
            i686-linux-gnu
            i686-w64-mingw32
            mingw-w64-x86_64
        )
        
        for host in "${hosts[@]}"; do
          cmake -Wno-dev -DCMAKE_TOOLCHAIN_FILE=../cross/${host}.cmake -DCMAKE_INSTALL_PREFIX=${host} -DCMAKE_BUILD_TYPE=MinSizeRel ../
          cmake --build ./ -j 50
          cmake --install ./
          
          rm --force --recursive ./*
        done
